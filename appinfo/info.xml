<?xml version="1.0"?>
<info xmlns:xsi= "http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="https://apps.nextcloud.com/schema/apps/info.xsd">
  <id>journeys</id>
  <name>Journeys</name>
  <summary>cluster images by time and location</summary>
    <description><![CDATA[
# Automatic Photo Album Creation for Nextcloud

Automatically cluster your images into journeys (vacations/trips) and create albums for each journey.
**Requires the Memories app!**

## ‚ú® Features
- **üó∫Ô∏è Location & Time Clustering:** Group images by when and where they were taken
- **üóÇÔ∏è Album Creation:** Albums are created automatically for each journey
- **‚öôÔ∏è Customizable:** Control minimum cluster size, time gap, and distance thresholds
- **üé• Video Rendering:** Turn journey albums into MP4 highlight reels (requires `ffmpeg` on the server)

## üöÄ OCC Command Usage

    php occ journeys:cluster-create-albums <user>

## üè† Using your home location (default)
Journeys segments the timeline into **near home** and **away from home** and applies sensible defaults for each to capture local days vs. trips.

## ‚è∞ Runs automatically
A background job runs **daily** to cluster newly added photos, and you‚Äôll receive a **notification** whenever new albums are created.

## üè∑Ô∏è How album names are created
Album titles are generated from the **resolved place name** and the **date range** of the cluster, e.g. `Iceland ‚Äî Aug¬†12‚Äì19,¬†2024`.

]]></description>
  <changelog><![CDATA[
  <h3>0.7.2 (2025-09-29)</h3>
    <ul>
      <li><b>Audio:</b> Journey videos now include (one of three randomly selected) soundtrack by mobygratis .</li>
    </ul>
    <h3>0.7.1 (2025-09-26)</h3>
    <ul>
      <li><b>Improvement:</b> Added Ken Burns motion with crossfades</li>
    </ul>
    <h3>0.7.0 (2025-09-26)</h3>
    <ul>
      <li><b>New:</b> Render Journey albums into MP4 videos directly from the personal settings page or via <code>occ journeys:render-cluster-video &lt;user&gt; &lt;albumId&gt;</code>.</li>
      <li><b>Requirement:</b> The Nextcloud server must have <code>ffmpeg</code> available in <code>PATH</code> for rendering to succeed.</li>
    </ul>
    <h3>0.6.0 (2025-09-19)</h3>
    <ul>
      <li><b>Packaging:</b> Release workflow now builds the frontend before packaging to ensure fresh assets are shipped.</li>
    </ul>
    <h3>0.5.8 (2025-09-19)</h3>
    <ul>
      <li><b>Settings (#7):</b> Personal settings page is now accessible to all logged-in users (per-user configuration; no admin required).</li>
      <li><b>Security:</b> Re-enabled CSRF protection on settings endpoints (removed <code>@NoCSRFRequired</code> annotations).</li>
    </ul>
    <h3>0.5.7 (2025-09-15)</h3>
    <ul>
      <li><b>Meta:</b> Version bump.</li>
    </ul>
    <h3>0.5.6 (2025-09-15)</h3>
    <ul>
      <li><b>Cleanup:</b> Removed legacy <code>appinfo/app.php</code> since the app uses <code>IBootstrap</code> via <code>lib/AppInfo/Application.php</code>. This eliminates the recurring log warning about <code>app.php</code> not being loaded.</li>
    </ul>
    <h3>0.5.5 (2025-09-10)</h3>
    <ul>
      <li><b>Default behavior change:</b> Clustering now uses your home location by default to segment near-home vs away-from-home and apply appropriate thresholds.</li>
      <li><b>New flag:</b> <code>--no-home-aware</code> to disable home-based segmentation and use a single global set of thresholds.</li>
      <li><b>Deprecated:</b> <code>--home-aware</code> (no longer required; default is on).</li>
      <li><b>Docs:</b> Updated description to explain how home location is used and how to opt out.</li>
    </ul>
    <h3>0.5.4 (2025-09-09)</h3>
    <ul>
      <li><b>Notifications:</b> Send a single aggregated notification per run (instead of one per album) with a quick link to open Photos.</li>
    </ul>
    <h3>0.5.3 (2025-09-08)</h3>
    <ul>
      <li><b>DB migration:</b> Added <code>start_dt</code> and <code>end_dt</code> columns plus index to <code>journeys_cluster_albums</code> for reliable incremental clustering.</li>
      <li><b>Fail-fast tracking:</b> Album tracking now throws on DB errors instead of silently ignoring them.</li>
    </ul>
    <h3>0.5.2 (2025-09-08)</h3>
    <ul>
      <li><b>Fix:</b> Prevent division by zero when interpolating locations for adjacent images with identical datetaken.</li>
    </ul>
    <h3>0.5.1 (2025-09-07)</h3>
    <ul>
      <li><b>Album creation safety:</b> No longer reuse existing albums by name. On name collision (e.g., manually created album), the cluster album is skipped and a warning is logged.</li>
      <li><b>Incremental fallback:</b> When no <code>end_dt</code> is recorded yet, derive the latest cluster end from tracked albums to set the incremental boundary (no title matching required).</li>
    </ul>
    <h3>0.5.0 (2025-09-07)</h3>
    <ul>
      <li><b>Incremental clustering (default):</b> Only process images taken after the latest tracked cluster end.</li>
      <li><b>New OCC flags:</b> <code>--from-scratch</code> to fully rebuild clusters; <code>--recent-cutoff-days</code> to control skipping of very recent trips (default 5; 0 disables).</li>
      <li><b>DB migration:</b> Track <code>start_dt</code>/<code>end_dt</code> for each clusterer-created album to support incremental runs.</li>
    </ul>
    <h3>0.4.3 (2025-09-05)</h3>
    <ul>
      <li><b>Skip no-location-only clusters:</b> Clusters composed entirely of images without coordinates are no longer turned into albums. Reduces noise from placeholder ‚ÄúJourney # (date range)‚Äù albums.</li>
    </ul>
    <h3>0.4.2 (2025-09-04)</h3>
    <ul>
      <li><b>Clustering robustness:</b> Prevent time-only tails (images without coordinates) from bridging over large spatial jumps by anchoring distance checks to the last-known geolocated photo within a cluster.</li>
    </ul>
    <h3>0.4.1 (2025-09-03)</h3>
    <ul>
      <li><b>Deterministic purge of cluster albums:</b> Introduced DB-backed tracking table for clusterer-created albums (per user), used during purge instead of folder tag/title heuristics. Prevents accumulation of albums across runs.</li>
      <li><b>Docs:</b> Clarified deterministic purge behavior on re-runs; added upgrade notes.</li>
      <li><b>Cleanup:</b> Removed runtime table creation; rely on app migration for schema.</li>
      <li><b>DB prefix fix:</b> Use <code>*PREFIX*</code> placeholder in SQL instead of accessing connection prefix.</li>
    </ul>
    <h3>0.4.0 (2025-09-03)</h3>
    <ul>
      <li><b>Home-aware clustering:</b> Segment timeline into near-home and away-from-home blocks; cluster each block independently.</li>
      <li><b>Near-home alignment:</b> when left at built-in defaults, near-home time gap aligns to global, and distance aligns to global but is capped at <b>25km</b> for finer local clustering.</li>
      <li><b>Away thresholds</b> default to 36h / 50km and can be tuned via CLI to better handle multi-day gaps during long trips.</li>
    </ul>
    <h3>0.3.2 (2025-07-27)</h3>
    <ul>
      <li><b>Default maxDistanceKm for clustering is now 50.0 (was 100.0)</b></li>
    </ul>

    <h3>0.3.1 (2025-07-20)</h3>
    <ul>
      <li><b>SystemTag-only album identification:</b> New albums are created without postfix, identified and managed solely via SystemTags.</li>
      <li><b>Legacy albums with postfix are still purged via fallback logic.</li>
      <li><b>Removal of postfix from new album names.</li>
    </ul>
    <h3>0.3.0-alpha (2025-07-20)</h3>
    <ul>
      <li><b>Spatial constraint for interpolation:</b> Only interpolate image locations if the two neighboring images are within 1km of each other.</li>
      <li><b>Stricter time gap for single neighbor:</b> When only one reference image is available, the time gap must not be larger than 1 hour.</li>
      <li><b>Improved clustering accuracy:</b> Prevented assignment of interpolated locations over large distances.</li>
    </ul>
  ]]></changelog>
  <licence>agpl</licence>
  <author mail="thrillfall@disroot.org">thrillfall</author>
  <version>0.7.2</version>
  <namespace>Journeys</namespace>
  <category>integration</category>
  <category>multimedia</category>
  <screenshot>https://raw.githubusercontent.com/thrillfall/journeys/main/appinfo/journeys.png</screenshot>
  <bugs>https://github.com/thrillfall/journeys/issues</bugs>
  <dependencies>
    <nextcloud min-version="30" max-version="32"/>
  </dependencies>
  <bootstrap>OCA\Journeys\AppInfo\Application</bootstrap>
  <commands>
    <command>OCA\Journeys\Command\FetchUserImagesCommand</command>
    <command>OCA\Journeys\Command\ClusterAndCreateAlbumsCommand</command>
    <command>OCA\Journeys\Command\RemoveAllAlbumsCommand</command>
    <command>OCA\Journeys\Command\ShowLatestClusterEndCommand</command>
    <command>OCA\Journeys\Command\RenderClusterVideoCommand</command>
    <command>OCA\Journeys\Command\ListClustersCommand</command>
  </commands>
  <background-jobs>
    <job>OCA\Journeys\BackgroundJob\DailyClusteringJob</job>
  </background-jobs>
  <settings>
    <personal>OCA\Journeys\Settings\PersonalSettings</personal>
    <personal-section>OCA\Journeys\Sections\PersonalSection</personal-section>
  </settings>
</info>
